{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProjectPro â€“ Projects</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { 
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      font-size: 13px; 
    }
    
    .glass {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(22px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 0.875rem;
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
      padding: 1rem;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
    }
    
    .glass:hover { 
      border-color: rgba(255, 255, 255, 0.3); 
      transform: translateY(-3px); 
      box-shadow: 0 6px 32px rgba(0, 0, 0, 0.18); 
    }

    /* Light theme (improved greyish) */
    body.light { 
      background: #e0e2e4; 
      color: #1e1e1e; 
    }
    
    body.light .glass {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    }
    
    body.light .sidebar {
      background: #f5f7f9;
      border-right: 1px solid #d1d5db;
    }
    
    body.light input, body.light textarea {
      background: #ffffff;
      border: 1px solid #c7c7cc;
      color: #1e1e1e;
    }
    
    body.light button.primary {
      background: linear-gradient(to right, #4b5563, #1f2937);
      color: #ffffff;
    }
    
    body.light button.primary:hover {
      background: linear-gradient(to right, #4a5568, #1e2a37);
    }
    
    body.light .icon { color: #4a4a4a; }

    /* Dark theme */
    body.dark {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
    }

    .sidebar.collapsed { width: 68px; }
    .sidebar.collapsed .title-text { display: none; }
    .sidebar.collapsed nav a span { display: none; }
    .sidebar.collapsed .user-name { display: none; }

    /* Enhanced animations */
    .transition-smooth { transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); }
    button:focus { outline: none; box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.3); }

    /* Status indicators */
    .status-active { background: linear-gradient(135deg, #007AFF 0%, #005cbf 100%); }
    .status-completed { background: linear-gradient(135deg, #34c759 0%, #248a3d 100%); }
    .status-planning { background: linear-gradient(135deg, #ff9500 0%, #d1810a 100%); }

    /* Progress bar */
    .progress-bar {
      background: linear-gradient(90deg, #007AFF 0%, #5856d6 100%);
      transition: width 0.5s ease;
    }

    /* Project card animations */
    .project-card {
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    .project-card:hover {
      transform: translateY(-8px) scale(1.02);
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .sidebar { width: 48px; }
      .sidebar:not(.collapsed) { width: 200px; }
      .sidebar.collapsed .title-text, .sidebar.collapsed nav a span, .sidebar.collapsed .user-name { display: none; }
      main { margin-left: 200px; }
      main.collapsed { margin-left: 48px; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
      .text-xl { font-size: 16px; }
      .text-lg { font-size: 15px; }
      .text-base { font-size: 13px; }
      .text-sm { font-size: 12px; }
      .text-xs { font-size: 10px; }
    }
    @media (max-width: 640px) {
      .sidebar { 
        width: 100%; 
        height: auto; 
        position: relative; 
        flex-direction: row; 
        justify-content: space-between; 
        padding: 0.75rem; 
        z-index: 10; 
      }
      .sidebar.collapsed { width: 100%; }
      main { margin-left: 0; margin-top: 70px; padding: 0.75rem; }
      .grid { grid-template-columns: 1fr; }
      .text-xl { font-size: 15px; }
      .text-lg { font-size: 14px; }
      .text-base { font-size: 12px; }
      .text-sm { font-size: 11px; }
      .text-xs { font-size: 10px; }
    }
  </style>
</head>
<body class="bg-[#0f0f23] text-[#f5f5f7] text-sm transition-smooth dark">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed left-0 top-0 h-screen w-60 bg-black/95 backdrop-blur-2xl border-r border-gray-900/60 p-5 flex flex-col justify-between transition-smooth z-20">
    <div>
      <div class="flex items-center justify-between mb-7">
        <span class="text-lg font-semibold title-text">ProjectPro</span>
        <button id="collapseToggle" class="text-gray-500 hover:text-white transition-smooth">
          <i data-lucide="panel-left-close" class="icon"></i>
        </button>
      </div>
      <nav class="flex flex-col space-y-3">
        <a href="{% url 'home' %}" class="flex items-center space-x-2.5 text-gray-400 hover:text-white transition-smooth">
          <i data-lucide="home" class="icon"></i><span>Home</span>
        </a>
      </nav>
    </div>
    <div class="flex flex-col space-y-3">
      <button id="themeToggle" class="w-9 h-9 flex items-center justify-center bg-white/5 rounded-full text-gray-500 hover:bg-white/10 transition-smooth">
        <i data-lucide="sun" class="icon"></i>
      </button>
      <div class="flex items-center space-x-2.5 text-gray-400">
        <div class="w-7 h-7 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center">
          <span class="text-xs text-white font-medium">U</span>
        </div>
        <span class="user-name text-xs font-medium">
          {% if request.user.is_authenticated %}
            {{ request.user.username }}
          {% else %}
            Guest
          {% endif %}
        </span>

      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="ml-60 p-7 transition-smooth min-h-screen" id="mainContent">
    <!-- Header -->
    <header class="flex justify-between items-center mb-7">
      <div>
        <h1 class="text-xl font-semibold mb-1.5">Projects</h1>
        <p class="text-sm text-gray-400">Manage and track all your projects in one place</p>
      </div>
      <div class="flex items-center space-x-3">
        <div class="relative">
          <input type="text" id="search-input" placeholder="Search projects..." 
                 class="pl-10 pr-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
          <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400 icon"></i>
        </div>
        <a href="{% url 'new_project' %}" class="primary px-3 py-1.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full text-xs font-medium hover:from-blue-700 hover:to-purple-700 transition-smooth">
          <i data-lucide="plus" class="w-4 h-4 inline mr-1 icon"></i>New Project
        </a>
      </div>
    </header>

    <!-- Filter Controls -->
    <div class="flex flex-wrap gap-3 mb-7">
      <select id="status-filter" class="px-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="completed">Completed</option>
        <option value="planning">Planning</option>
      </select>
      <select id="category-filter" class="px-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
        <option value="">All Categories</option>
        <option value="Web Development">Web Development</option>
        <option value="Mobile Development">Mobile Development</option>
        <option value="Data Science">Data Science</option>
        <option value="Security">Security</option>
        <option value="Design">Design</option>
        <option value="Marketing">Marketing</option>
      </select>
      <div class="flex gap-2 ml-auto">
        <button id="grid-view" class="p-2 bg-white/10 rounded-lg text-gray-400 hover:text-white hover:bg-white/20 transition-smooth active">
          <i data-lucide="grid-3x3" class="w-4 h-4 icon"></i>
        </button>
        <button id="list-view" class="p-2 bg-white/5 rounded-lg text-gray-400 hover:text-white hover:bg-white/20 transition-smooth">
          <i data-lucide="list" class="w-4 h-4 icon"></i>
        </button>
      </div>
    </div>

    <!-- Projects Section -->
    <section id="projects-container">
      {% if projects %}
        <!-- Grid View -->
        <div id="grid-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-7">
          {% for project in projects %}
            <div class="project-card glass cursor-pointer" 
                 data-status="{{ project.status|default:''|lower }}" 
                 data-category="{{ project.category|default:''|lower }}"
                 data-name="{{ project.name|default:''|lower }}"
                 onclick="showProjectDetail({{ project.id|default:0 }})">
              <!-- Project Header -->
              <div class="flex items-center justify-between mb-4">
                <div class="w-10 h-10 bg-gradient-to-r 
                  {% if project.status|lower == 'completed' %}status-completed
                  {% elif project.status|lower == 'active' %}status-active
                  {% else %}status-planning{% endif %} 
                  rounded-xl flex items-center justify-center">
                  <i data-lucide="folder" class="w-5 h-5 text-white icon"></i>
                </div>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                  {% if project.status|lower == 'completed' %}bg-green-500/20 text-green-400 border border-green-500/30
                  {% elif project.status|lower == 'active' %}bg-blue-500/20 text-blue-400 border border-blue-500/30
                  {% else %}bg-orange-500/20 text-orange-400 border border-orange-500/30{% endif %}">
                  {{ project.status|default:'Planning'|title }}
                </span>
              </div>
              <!-- Project Content -->
              <h3 class="text-base font-semibold mb-2">{{ project.name|default:'Untitled Project' }}</h3>
              <p class="text-xs text-gray-400 mb-4 line-clamp-2">{{ project.description|default:'No description provided'|truncatechars:100 }}</p>
              {% if project.category %}
                <div class="mb-4">
                  <span class="inline-block bg-white/10 text-gray-300 text-xs px-3 py-1 rounded-full">
                    {{ project.category }}
                  </span>
                </div>
              {% endif %}
              <!-- Progress Section -->
              <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-gray-400">Progress</span>
                  <span class="text-xs font-medium">{{ project.progress|default:0 }}%</span>
                </div>
                <div class="w-full bg-gray-700/50 rounded-full h-2">
                  <div class="progress-bar h-2 rounded-full" style="width: {{ project.progress|default:0 }}%"></div>
                </div>
              </div>
              <!-- Project Footer -->
              <div class="flex items-center justify-between pt-4 border-t border-gray-700/30">
                <div class="flex items-center space-x-2">
                  <div class="flex -space-x-2">
                    {% if project.team_size|default:0 > 0 %}
                      {% for i in "123"|slice:":project.team_size|default:0"|slice:":3" %}
                        <div class="w-6 h-6 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full border-2 border-gray-800 flex items-center justify-center">
                          <span class="text-xs text-white font-medium">{{ forloop.counter }}</span>
                        </div>
                      {% endfor %}
                      {% if project.team_size|default:0 > 3 %}
                        <div class="w-6 h-6 bg-gray-600 rounded-full border-2 border-gray-800 flex items-center justify-center">
                          <span class="text-xs text-white font-medium">+{{ project.team_size|add:"-3" }}</span>
                        </div>
                      {% endif %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- List View -->
        <div id="list-container" class="hidden space-y-4">
          {% for project in projects %}
            <div class="project-card glass p-5 cursor-pointer" 
                 data-status="{{ project.status|default:''|lower }}" 
                 data-category="{{ project.category|default:''|lower }}"
                 data-name="{{ project.name|default:''|lower }}"
                 onclick="showProjectDetail({{ project.id|default:0 }})">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 flex-1">
                  <div class="w-10 h-10 bg-gradient-to-r 
                    {% if project.status|lower == 'completed' %}status-completed
                    {% elif project.status|lower == 'active' %}status-active
                    {% else %}status-planning{% endif %} 
                    rounded-xl flex items-center justify-center">
                    <i data-lucide="folder" class="w-5 h-5 text-white icon"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-3 mb-1">
                      <h3 class="text-base font-semibold truncate">{{ project.name|default:'Untitled Project' }}</h3>
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                        {% if project.status|lower == 'completed' %}bg-green-500/20 text-green-400
                        {% elif project.status|lower == 'active' %}bg-blue-500/20 text-blue-400
                        {% else %}bg-orange-500/20 text-orange-400{% endif %}">
                        {{ project.status|default:'Planning'|title }}
                      </span>
                    </div>
                    <p class="text-xs text-gray-400 mb-2">{{ project.description|default:'No description provided'|truncatechars:150 }}</p>
                    <div class="flex items-center space-x-4 text-xs text-gray-500">
                      <span>{{ project.team_size|default:0 }} members</span>
                      {% if project.category %}
                        <span>{{ project.category }}</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="flex items-center space-x-4">
                  <div class="text-right">
                    <div class="text-xs font-medium mb-1">{{ project.progress|default:0 }}%</div>
                    <div class="w-20 bg-gray-700/50 rounded-full h-2">
                      <div class="progress-bar h-2 rounded-full" style="width: {{ project.progress|default:0 }}%"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- Empty State -->
        <div class="text-center py-20">
          <div class="glass w-20 h-20 flex items-center justify-center mx-auto mb-5">
            <i data-lucide="folder-plus" class="w-10 h-10 text-gray-400 icon"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">No projects found</h3>
          <p class="text-xs text-gray-400 mb-6">Get started by creating your first project</p>
          <a href="{% url 'new_project' %}" class="primary px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full text-xs font-medium hover:from-blue-700 hover:to-purple-700 transition-smooth">
            <i data-lucide="plus" class="w-4 h-4 inline mr-1 icon"></i>Create Your First Project
          </a>
        </div>
      {% endif %}
    </section>
  </main>

  <!-- Removed Create Project Modal -->

  <script>
    const toggle = document.getElementById('themeToggle');
    const collapseToggle = document.getElementById('collapseToggle');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const body = document.body;

    // Theme toggle functionality
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
      body.classList.remove('dark');
      body.classList.add('light');
      toggle.querySelector('i').setAttribute('data-lucide', 'moon');
    } else {
      body.classList.remove('light');
      body.classList.add('dark');
      toggle.querySelector('i').setAttribute('data-lucide', 'sun');
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('light');
      body.classList.toggle('dark');
      const isLight = body.classList.contains('light');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      const icon = toggle.querySelector('i');
      icon.setAttribute('data-lucide', isLight ? 'moon' : 'sun');
      lucide.createIcons();
    });

    // Sidebar collapse functionality
    const savedCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (savedCollapsed) {
      sidebar.classList.add('collapsed');
      mainContent.classList.remove('ml-60');
      mainContent.classList.add('ml-20');
    } else {
      mainContent.classList.add('ml-60');
    }

    collapseToggle.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      const isCollapsed = sidebar.classList.contains('collapsed');
      localStorage.setItem('sidebarCollapsed', isCollapsed);
      setTimeout(updateMainMargin, 300); // Sync with transition
    });

    // Responsive sidebar handling
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 640) {
        sidebar.classList.add('collapsed');
        mainContent.classList.remove('ml-60', 'ml-20');
        mainContent.classList.add('mt-16');
        sidebar.style.position = 'relative';
        sidebar.style.height = 'auto';
      } else {
        sidebar.classList.toggle('collapsed', savedCollapsed);
        mainContent.classList.remove('mt-16');
        setTimeout(updateMainMargin, 300); // Sync with transition
      }
    });

    // Function to update main margin based on sidebar state
    function updateMainMargin() {
      if (window.innerWidth <= 640) {
        mainContent.classList.remove('ml-60', 'ml-20');
        mainContent.classList.add('mt-16');
      } else {
        mainContent.classList.remove('mt-16', 'ml-20', 'ml-60');
        mainContent.classList.add(sidebar.classList.contains('collapsed') ? 'ml-20' : 'ml-60');
      }
    }

    // Initial margin update
    updateMainMargin();

    // Project filtering
    const searchInput = document.getElementById('search-input');
    const statusFilter = document.getElementById('status-filter');
    const categoryFilter = document.getElementById('category-filter');

    function filterProjects() {
      const searchTerm = (searchInput ? searchInput.value.toLowerCase().trim() : '');
      const statusValue = (statusFilter ? statusFilter.value.toLowerCase() : '');
      const categoryValue = (categoryFilter ? categoryFilter.value.toLowerCase() : '');
      
      const projectCards = document.querySelectorAll('.project-card');
      
      projectCards.forEach(card => {
        const name = card.dataset.name || '';
        const status = card.dataset.status || '';
        const category = card.dataset.category || '';
        
        const matchesSearch = name.includes(searchTerm);
        const matchesStatus = !statusValue || status === statusValue;
        const matchesCategory = !categoryValue || category === categoryValue;
        
        card.style.display = matchesSearch && matchesStatus && matchesCategory ? '' : 'none';
      });
    }

    if (searchInput) searchInput.addEventListener('input', filterProjects);
    if (statusFilter) statusFilter.addEventListener('change', filterProjects);
    if (categoryFilter) categoryFilter.addEventListener('change', filterProjects);

    // View toggle with default initialization
    const gridViewBtn = document.getElementById('grid-view');
    const listViewBtn = document.getElementById('list-view');
    const gridContainer = document.getElementById('grid-container');
    const listContainer = document.getElementById('list-container');

    if (gridViewBtn && listViewBtn && gridContainer && listContainer) {
      // Set default view to grid on page load
      gridContainer.classList.remove('hidden');
      listContainer.classList.add('hidden');
      gridViewBtn.classList.add('bg-white/10');
      listViewBtn.classList.remove('bg-white/10');

      gridViewBtn.addEventListener('click', () => {
        gridContainer.classList.remove('hidden');
        listContainer.classList.add('hidden');
        gridViewBtn.classList.add('bg-white/10');
        listViewBtn.classList.remove('bg-white/10');
      });

      listViewBtn.addEventListener('click', () => {
        gridContainer.classList.add('hidden');
        listContainer.classList.remove('hidden');
        listViewBtn.classList.add('bg-white/10');
        gridViewBtn.classList.remove('bg-white/10');
      });
    }

    // Removed Modal functionality

    // Project detail function with robustness
    window.showProjectDetail = function(projectId) {
      if (projectId && projectId > 0) {
        window.location.href = `/project/${projectId}`;
      }
    };

    // Initialize Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>