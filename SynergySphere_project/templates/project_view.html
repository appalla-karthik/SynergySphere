{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SynergySphere - Projects</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { 
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      font-size: 13px; 
    }
    
    .glass {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(22px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 0.875rem;
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
      padding: 1rem;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
    }
    
    .glass:hover { 
      border-color: rgba(255, 255, 255, 0.3); 
      transform: translateY(-3px); 
      box-shadow: 0 6px 32px rgba(0, 0, 0, 0.18); 
    }

    /* Light theme (improved greyish) */
    body.light { 
      background: #e0e2e4; 
      color: #1e1e1e; 
    }
    
    body.light .glass {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    }
    
    body.light .sidebar {
      background: #f5f7f9;
      border-right: 1px solid #d1d5db;
    }
    
    body.light input, body.light textarea {
      background: #ffffff;
      border: 1px solid #c7c7cc;
      color: #1e1e1e;
    }
    
    body.light button.primary {
      background: linear-gradient(to right, #4b5563, #1f2937);
      color: #ffffff;
    }
    
    body.light button.primary:hover {
      background: linear-gradient(to right, #4a5568, #1e2a37);
    }
    
    body.light .icon { color: #4a4a4a; }

    /* Dark theme */
    body.dark {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
    }

    .sidebar.collapsed { width: 68px; }
    .sidebar.collapsed .title-text { display: none; }
    .sidebar.collapsed nav a span { display: none; }
    .sidebar.collapsed .user-name { display: none; }

    /* Enhanced animations */
    .transition-smooth { transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); }
    button:focus { outline: none; box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.3); }

    /* Status indicators */
    .status-active { background: linear-gradient(135deg, #007AFF 0%, #005cbf 100%); }
    .status-completed { background: linear-gradient(135deg, #34c759 0%, #248a3d 100%); }
    .status-planning { background: linear-gradient(135deg, #ff9500 0%, #d1810a 100%); }

    /* Progress bar */
    .progress-bar {
      background: linear-gradient(90deg, #007AFF 0%, #5856d6 100%);
      transition: width 0.5s ease;
    }

    /* Project card animations */
    .project-card {
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    .project-card:hover {
      transform: translateY(-8px) scale(1.02);
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .sidebar { width: 48px; }
      .sidebar:not(.collapsed) { width: 200px; }
      .sidebar.collapsed .title-text, .sidebar.collapsed nav a span, .sidebar.collapsed .user-name { display: none; }
      main { margin-left: 200px; }
      main.collapsed { margin-left: 48px; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
      .text-xl { font-size: 16px; }
      .text-lg { font-size: 15px; }
      .text-base { font-size: 13px; }
      .text-sm { font-size: 12px; }
      .text-xs { font-size: 10px; }
    }
    @media (max-width: 640px) {
      .sidebar { 
        width: 100%; 
        height: auto; 
        position: relative; 
        flex-direction: row; 
        justify-content: space-between; 
        padding: 0.75rem; 
        z-index: 10; 
      }
      .sidebar.collapsed { width: 100%; }
      main { margin-left: 0; margin-top: 70px; padding: 0.75rem; }
      .grid { grid-template-columns: 1fr; }
      .text-xl { font-size: 15px; }
      .text-lg { font-size: 14px; }
      .text-base { font-size: 12px; }
      .text-sm { font-size: 11px; }
      .text-xs { font-size: 10px; }
    }


    /* Global background */
body.dark { 
  background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
  color: #f5f5f7;
}
body.light { 
  background: #f3f4f6; /* softer grey background */
  color: #1f2937;
}

/* Sidebar */
body.dark .sidebar {
  background: rgba(0,0,0,0.95);
  border-right: 1px solid rgba(255,255,255,0.1);
}
body.light .sidebar {
  background: #ffffff;
  border-right: 1px solid #d1d5db;
  color: #111827;
}

/* Glass effect cards */
body.dark .glass {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
}
body.light .glass {
  background: #ffffff;
  border: 1px solid #e5e7eb;
}

/* Inputs */
body.dark input, body.dark textarea {
  background: #1f2937;
  border: 1px solid #374151;
  color: #f5f5f7;
}
body.light input, body.light textarea {
  background: #ffffff;
  border: 1px solid #d1d5db;
  color: #111827;
}
.sidebar.collapsed { width: 72px; }
.sidebar.collapsed .title-text,
.sidebar.collapsed .nav-text,
.sidebar.collapsed .user-name { display: none; }

  </style>
</head>
<body class="bg-[#0f0f23] text-[#f5f5f7] text-sm transition-smooth dark">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed left-0 top-0 h-screen w-60 bg-black/95 backdrop-blur-2xl border-r border-gray-900/60 p-5 flex flex-col justify-between transition-smooth z-20">
  <div>
    <div class="flex items-center justify-between mb-7">
      <span class="text-lg font-semibold title-text">SynergySphere</span>
      <button id="collapseToggle" class="text-gray-500 hover:text-white transition-smooth">
        <i data-lucide="panel-left-close" class="icon"></i>
      </button>
    </div>
    <nav class="flex flex-col space-y-3">
      <a href="{% url 'home' %}" class="flex items-center space-x-2.5 text-gray-400 hover:text-white transition-smooth">
        <i data-lucide="home" class="icon"></i><span>Home</span>
      </a>
    </nav>
  </div>

  <!-- ‚úÖ User Info -->
  <div class="flex flex-col space-y-3">
    <!-- Theme Toggle -->
    <button id="themeToggle" class="w-9 h-9 flex items-center justify-center bg-white/5 rounded-full text-gray-500 hover:bg-white/10 transition-smooth">
      <i data-lucide="sun" class="icon"></i>
    </button>

    <!-- ‚úÖ Dynamic Profile Image -->
    <div class="flex items-center space-x-2.5 text-gray-400">
      <div class="w-8 h-8 rounded-full overflow-hidden border border-gray-700">
        <img src="{% if request.user.is_authenticated and request.user.profile.image %}{{ request.user.profile.image.url }}{% else %}{% static 'images/avatar.png' %}{% endif %}"
             alt="User Avatar"
             class="w-full h-full object-cover">
      </div>
      <span class="user-name text-xs font-medium">
        {% if request.user.is_authenticated %}
          {{ request.user.username }}
        {% else %}
          Guest
        {% endif %}
      </span>
    </div>
  </div>
</aside>


  <!-- Main Content -->
  <main class="ml-60 p-7 transition-smooth min-h-screen" id="mainContent">
    <!-- Header -->
    <header class="flex justify-between items-center mb-7">
      <div>
        <h1 class="text-xl font-semibold mb-1.5">Projects</h1>
        <p class="text-sm text-gray-400">Manage and track all your projects in one place</p>
      </div>
      <div class="flex items-center space-x-3">
        <div class="relative">
          <input type="text" id="search-input" placeholder="Search projects..." 
                 class="pl-10 pr-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
          <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400 icon"></i>
        </div>
        <a href="{% url 'new_project' %}" class="primary px-3 py-1.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full text-xs font-medium hover:from-blue-700 hover:to-purple-700 transition-smooth">
          <i data-lucide="plus" class="w-4 h-4 inline mr-1 icon"></i>New Project
        </a>
      </div>
    </header>

    <!-- Filter Controls -->
    <div class="flex flex-wrap gap-3 mb-7">
      <select id="status-filter" class="px-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="completed">Completed</option>
        <option value="planning">Planning</option>
      </select>
      <select id="category-filter" class="px-3 py-1.5 bg-black/40 border border-gray-800 rounded-full text-xs focus:outline-none focus:border-gray-600 transition-smooth">
        <option value="">All Categories</option>
        <option value="Web Development">Web Development</option>
        <option value="Mobile Development">Mobile Development</option>
        <option value="Data Science">Data Science</option>
        <option value="Security">Security</option>
        <option value="Design">Design</option>
        <option value="Marketing">Marketing</option>
      </select>
      <div class="flex gap-2 ml-auto">
        <button id="grid-view" class="p-2 bg-white/10 rounded-lg text-gray-400 hover:text-white hover:bg-white/20 transition-smooth active">
          <i data-lucide="grid-3x3" class="w-4 h-4 icon"></i>
        </button>
        <button id="list-view" class="p-2 bg-white/5 rounded-lg text-gray-400 hover:text-white hover:bg-white/20 transition-smooth">
          <i data-lucide="list" class="w-4 h-4 icon"></i>
        </button>
      </div>
    </div>

    <!-- Projects Section -->
        <!-- Projects Section -->
    <section id="projects-container">
      {% if projects %}
        <!-- Grid View -->
        <div id="grid-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-7">
          {% for project in projects %}
            <div class="project-card glass relative cursor-pointer group overflow-hidden"
      data-status="{{ project.status|default:''|lower }}"
      data-category="{{ project.category|default:''|lower }}"
      data-name="{{ project.name|default:''|lower }}"
      onclick="showProjectDetail({{ project.id|default:0 }})">

  <!-- Tags -->
 <!-- Tags -->
<div class="flex flex-wrap gap-2 mb-2">
  {% if project.tags %}
    {% for tag in project.tags|split:"," %}
      <span class="px-2 py-0.5 rounded-full text-xs font-medium 
                  bg-gradient-to-r from-gray-700/40 to-gray-800/40 
                  border border-gray-600/40 text-gray-300">
        {{ tag|trim }}
      </span>
    {% endfor %}
  {% else %}
    <span class="text-gray-500 text-xs">No Tags</span>
  {% endif %}
</div>

  <!-- Project Title -->
  <h3 class="font-semibold text-sm mb-3 group-hover:text-blue-400 transition-colors">
    {{ project.name|default:'Untitled Project' }}
  </h3>

  <!-- Preview Image -->
<div class="flex mb-4">
  {% if project.image %}
  <img src="{{ project.image.url }}" alt="Preview"
      class="w-full h-32 object-cover rounded-lg border border-gray-700/40 shadow-sm hover:scale-[1.02] transition-transform duration-300">
  {% else %}
  <div class="w-full h-32 bg-gray-700/40 rounded-lg flex items-center justify-center text-gray-400 text-xs border border-gray-600/30">
    No Img
  </div>
  {% endif %}
</div>


  <!-- Footer: Manager + Deadline + Tasks -->
  <div class="flex justify-between items-center pt-3 border-t border-gray-700/30">
    <!-- Manager -->
    <div class="flex items-center space-x-2">
    {% if project.manager.avatar %}
      <img src="{{ project.manager.avatar.url }}" class="w-7 h-7 rounded-full border border-gray-700 shadow-sm">
    {% else %}
      <div class="w-7 h-7 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center text-xs text-white">
        {{ project.manager.username|slice:":1"|upper }}
      </div>
    {% endif %}

      <span class="text-xs text-gray-400">{{ project.manager.username }}</span>
    </div>

    <!-- Deadline -->
    {% if project.deadline %}
      <span class="text-xs px-2 py-0.5 rounded-full bg-red-500/20 text-red-400 border border-red-500/30">
        D-{{ project.days_left }}
      </span>
    {% endif %}

    <!-- Tasks -->
    <span class="px-2 py-0.5 text-xs rounded-full bg-gray-700/40 text-gray-300 border border-gray-600/40">
      {{ project.task_set.count }} Tasks
    </span>

    <!-- Context Menu -->
    <div class="relative">
      <button class="text-gray-400 hover:text-white" onclick="openProjectMenu(event, {{ project.id }})">
        <i data-lucide="more-vertical" class="w-4 h-4"></i>
      </button>
      <div id="menu-{{ project.id }}" class="hidden absolute right-0 mt-2 w-28 rounded-lg bg-black/90 border border-gray-700 shadow-lg z-30">
        <a href="{% url 'edit_project' project.id %}" class="block px-3 py-1.5 text-xs text-gray-300 hover:bg-white/10 rounded-t-lg">Edit</a>
        <a href="{% url 'delete_project' project.id %}" class="block px-3 py-1.5 text-xs text-red-400 hover:bg-white/10 rounded-b-lg">Delete</a>
      </div>
    </div>
  </div>
</div>

          {% endfor %}
        </div>

        <!-- List View -->
        <div id="list-container" class="hidden divide-y divide-gray-800">
          {% for project in projects %}
            <div class="flex items-center justify-between py-4 px-3 rounded-lg cursor-pointer hover:bg-white/5 transition-all"
                 onclick="showProjectDetail({{ project.id|default:0 }})">

              <!-- Left Section -->
              <div class="flex items-center space-x-4">
                <!-- Title & Tags -->
                <div>
                  <h3 class="font-semibold text-sm mb-1 group-hover:text-blue-400 transition-colors">
                    {{ project.name|default:'Untitled Project' }}
                  </h3>
                  <div class="flex flex-wrap gap-2">
                    {% for tag in project.tags.all %}
                      <span class="px-2 py-0.5 rounded-full text-xs font-medium border backdrop-blur-sm
                        {% cycle 'bg-pink-500/20 text-pink-300 border-pink-400/30' 
                                 'bg-blue-500/20 text-blue-300 border-blue-400/30' 
                                 'bg-green-500/20 text-green-300 border-green-400/30' 
                                 'bg-purple-500/20 text-purple-300 border-purple-400/30' %}">
                        {{ tag.name }}
                      </span>
                    {% endfor %}
                  </div>
                </div>
              </div>

              <!-- Right Section -->
              <div class="flex items-center space-x-6">
                {% if project.deadline %}
                  <span class="text-xs text-gray-400">
                    ‚è≥ {{ project.deadline|date:"d M, Y" }} (D-{{ project.days_left }})
                  </span>
                {% endif %}
                <div class="flex items-center space-x-2">
                {% if project.manager.avatar %}
                  <img src="{{ project.manager.avatar.url }}" class="w-7 h-7 rounded-full border border-gray-700 shadow-sm">
                {% else %}
                  <div class="w-7 h-7 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center text-xs text-white">
                    {{ project.manager.username|slice:":1"|upper }}
                  </div>
                {% endif %}

                  <span class="text-xs text-gray-400">{{ project.manager.username }}</span>
                </div>
                <span class="px-2 py-0.5 text-xs rounded-full bg-gray-700/40 text-gray-300 border border-gray-600/40">
                  {{ project.task_set.count }} Tasks
                </span>
                <button class="text-gray-400 hover:text-white" onclick="openProjectMenu(event, {{ project.id }})">
                  <i data-lucide="more-vertical" class="w-4 h-4"></i>
                </button>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- Empty State -->
        <div class="text-center py-20">
          <div class="glass w-20 h-20 flex items-center justify-center mx-auto mb-5">
            <i data-lucide="folder-plus" class="w-10 h-10 text-gray-400 icon"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">No projects found</h3>
          <p class="text-xs text-gray-400 mb-6">Get started by creating your first project</p>
          <a href="{% url 'new_project' %}" class="primary px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full text-xs font-medium hover:from-blue-700 hover:to-purple-700 transition-smooth">
            <i data-lucide="plus" class="w-4 h-4 inline mr-1 icon"></i>Create Your First Project
          </a>
        </div>
      {% endif %}
    </section>

  </main>

  <!-- Removed Create Project Modal -->

  <script>
    const toggle = document.getElementById('themeToggle');
    const collapseToggle = document.getElementById('collapseToggle');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const body = document.body;

    // Theme toggle functionality
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
      body.classList.remove('dark');
      body.classList.add('light');
      toggle.querySelector('i').setAttribute('data-lucide', 'moon');
    } else {
      body.classList.remove('light');
      body.classList.add('dark');
      toggle.querySelector('i').setAttribute('data-lucide', 'sun');
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('light');
      body.classList.toggle('dark');
      const isLight = body.classList.contains('light');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      const icon = toggle.querySelector('i');
      icon.setAttribute('data-lucide', isLight ? 'moon' : 'sun');
      lucide.createIcons();
    });

    // Sidebar collapse functionality
    const savedCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (savedCollapsed) {
      sidebar.classList.add('collapsed');
      mainContent.classList.remove('ml-60');
      mainContent.classList.add('ml-20');
    } else {
      mainContent.classList.add('ml-60');
    }

    collapseToggle.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      const isCollapsed = sidebar.classList.contains('collapsed');
      localStorage.setItem('sidebarCollapsed', isCollapsed);
      setTimeout(updateMainMargin, 300); // Sync with transition
    });

    // Responsive sidebar handling
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 640) {
        sidebar.classList.add('collapsed');
        mainContent.classList.remove('ml-60', 'ml-20');
        mainContent.classList.add('mt-16');
        sidebar.style.position = 'relative';
        sidebar.style.height = 'auto';
      } else {
        sidebar.classList.toggle('collapsed', savedCollapsed);
        mainContent.classList.remove('mt-16');
        setTimeout(updateMainMargin, 300); // Sync with transition
      }
    });

    // Function to update main margin based on sidebar state
    function updateMainMargin() {
      if (window.innerWidth <= 640) {
        mainContent.classList.remove('ml-60', 'ml-20');
        mainContent.classList.add('mt-16');
      } else {
        mainContent.classList.remove('mt-16', 'ml-20', 'ml-60');
        mainContent.classList.add(sidebar.classList.contains('collapsed') ? 'ml-20' : 'ml-60');
      }
    }

    // Initial margin update
    updateMainMargin();

    // Project filtering
    const searchInput = document.getElementById('search-input');
    const statusFilter = document.getElementById('status-filter');
    const categoryFilter = document.getElementById('category-filter');

    function filterProjects() {
      const searchTerm = (searchInput ? searchInput.value.toLowerCase().trim() : '');
      const statusValue = (statusFilter ? statusFilter.value.toLowerCase() : '');
      const categoryValue = (categoryFilter ? categoryFilter.value.toLowerCase() : '');
      
      const projectCards = document.querySelectorAll('.project-card');
      
      projectCards.forEach(card => {
        const name = card.dataset.name || '';
        const status = card.dataset.status || '';
        const category = card.dataset.category || '';
        
        const matchesSearch = name.includes(searchTerm);
        const matchesStatus = !statusValue || status === statusValue;
        const matchesCategory = !categoryValue || category === categoryValue;
        
        card.style.display = matchesSearch && matchesStatus && matchesCategory ? '' : 'none';
      });
    }

    if (searchInput) searchInput.addEventListener('input', filterProjects);
    if (statusFilter) statusFilter.addEventListener('change', filterProjects);
    if (categoryFilter) categoryFilter.addEventListener('change', filterProjects);

    // View toggle with default initialization
    const gridViewBtn = document.getElementById('grid-view');
    const listViewBtn = document.getElementById('list-view');
    const gridContainer = document.getElementById('grid-container');
    const listContainer = document.getElementById('list-container');

    if (gridViewBtn && listViewBtn && gridContainer && listContainer) {
      // Set default view to grid on page load
      gridContainer.classList.remove('hidden');
      listContainer.classList.add('hidden');
      gridViewBtn.classList.add('bg-white/10');
      listViewBtn.classList.remove('bg-white/10');

      gridViewBtn.addEventListener('click', () => {
        gridContainer.classList.remove('hidden');
        listContainer.classList.add('hidden');
        gridViewBtn.classList.add('bg-white/10');
        listViewBtn.classList.remove('bg-white/10');
      });

      listViewBtn.addEventListener('click', () => {
        gridContainer.classList.add('hidden');
        listContainer.classList.remove('hidden');
        listViewBtn.classList.add('bg-white/10');
        gridViewBtn.classList.remove('bg-white/10');
      });
    }

    // Removed Modal functionality

      // Project detail function with robustness
    window.showProjectDetail = function(projectId) {
      if (projectId && projectId > 0) {
        // üëá ab ye tasks view ke liye redirect karega
        window.location.href = `/tasks/${projectId}/`;
      }
    };

    // Initialize Lucide icons
    lucide.createIcons();
    function openProjectMenu(e, id) {
  e.stopPropagation();
  document.querySelectorAll("[id^='menu-']").forEach(m => m.classList.add("hidden"));
  const menu = document.getElementById(`menu-${id}`);
  if (menu) menu.classList.toggle("hidden");
}

// Close menus when clicking outside
document.addEventListener("click", () => {
  document.querySelectorAll("[id^='menu-']").forEach(m => m.classList.add("hidden"));
});

  </script>
</body>
</html>